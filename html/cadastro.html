<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodeWithUs</title>
  <link rel="stylesheet" href="../CSS/cadastro.css" />
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
</head>

<body>
  <div class="card">
    <div class="swiper">
      <div class="swiper-wrapper">
        <!-- Slide 1: E-mail -->
        <div class="swiper-slide">
          <img src="../imgs/1.svg" />
          <h2>Bem vindo!</h2>
          <h3>Entre com seu E-mail</h3>
          <input spellcheck="false" oninput="checkValid(event)" type="email" placeholder="CodeWithUs@gmail.com" name="email" id="email" />
          <button id="btn-email" disabled type="button" onclick="gotoSlide(1)">Próximo</button>
        </div>
        <!-- Slide 2: Senha -->
        <div class="swiper-slide">
          <div class="image-wrapper">
            <img src="../imgs/2.svg" />
          </div>
          <h2>Senha</h2>
          <h3>Entre com uma senha forte</h3>
          <input oninput="checkValid(event)" type="password" placeholder="Sua senha" name="senha" id="senha" />
          <button id="btn-senha" disabled type="button" onclick="gotoSlide(2)">Próximo</button>
        </div>
        <!-- Slide 3: Confirmação -->
        <div class="swiper-slide">
          <div class="image-wrapper">
            <img src="../imgs/3.svg" />
          </div>
          <h2>Fim</h2>
          <h3>Curta seus cursos!</h3>
          <button class="secondary" onclick="restart()">Refazer Cadastro</button>
          <button type="submit" onclick="saveCadastro()">Salvar Cadastro</button> <!-- Alteração aqui -->
        </div>
      </div>
      <div class="swiper-pagination"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
  <script>
    const swiper = new Swiper('.swiper', {
      pagination: {
        el: '.swiper-pagination',
      },
      allowSlideNext: false, // Disable slide-next initially
    });

    // Função para validar campos e liberar o botão 'Próximo'
    function checkValid(event) {
      const field = event.target;
      const email = document.getElementById('email').value;
      const senha = document.getElementById('senha').value;
      
      if (field.name === "email") {
        const emailValid = validateEmail(email);
        document.getElementById('btn-email').disabled = !emailValid;
      } else if (field.name === "senha") {
        const senhaValid = senha.length >= 6;
        document.getElementById('btn-senha').disabled = !senhaValid;
      }
    }

    // Função simples de validação de e-mail
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(String(email).toLowerCase());
    }

    // Função para mover para o próximo slide
    function gotoSlide(index) {
      swiper.allowSlideNext = true; // Ativar navegação ao próximo slide
      swiper.slideTo(index);
      swiper.allowSlideNext = false; // Desativar navegação para futuros cliques
    }

    // Função para salvar o cadastro
    async function saveCadastro() {
      const email = document.getElementById('email').value;
      const senha = document.getElementById('senha').value;

      const response = await fetch('/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email, senha }),
      });

      if (response.ok) {
        window.location.href = '../html/login.html'; // Redirecionar para a página de login
      } else {
        const errorMessage = await response.text();
        alert(errorMessage); // Exibe a mensagem de erro recebida do servidor
      }
    }

    // Reinicia o cadastro, voltando ao primeiro slide
    function restart() {
      swiper.slideTo(0);
      document.getElementById('email').value = '';
      document.getElementById('senha').value = '';
      document.getElementById('btn-email').disabled = true;
      document.getElementById('btn-senha').disabled = true;
    }
  </script>
</body>

</html>
